{% extends 'base.html' %}
{% load static %}

{% block title %}Catálogo de IAs{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Catálogo de IAs</h1>

    <!-- Search and Filter Form -->
    <form action="{% url 'catalog' %}" method="GET" class="mb-4">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" class="form-control" name="searchAITool" placeholder="Buscar herramienta IA..." value="{{ searchTerm }}"/>
                    <button type="submit" class="btn btn-primary">Buscar</button>
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" name="category" onchange="this.form.submit()">
                    <option value="">Todas las categorías</option>
                    {% for category in categories %}
                        <option value="{{ category }}" {% if current_category == category %}selected{% endif %}>{{ category }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" name="sort_by" onchange="this.form.submit()">
                    <option value="-popularity" {% if current_sort == '-popularity' %}selected{% endif %}>Popularidad ↓</option>
                    <option value="popularity" {% if current_sort == 'popularity' %}selected{% endif %}>Popularidad ↑</option>
                    <option value="name" {% if current_sort == 'name' %}selected{% endif %}>Nombre A-Z</option>
                    <option value="-name" {% if current_sort == '-name' %}selected{% endif %}>Nombre Z-A</option>
                    <option value="provider" {% if current_sort == 'provider' %}selected{% endif %}>Proveedor A-Z</option>
                    <option value="-provider" {% if current_sort == '-provider' %}selected{% endif %}>Proveedor Z-A</option>
                </select>
            </div>
        </div>
    </form>

    {% if searchTerm %}
        <div class="alert alert-info d-flex justify-content-between align-items-center">
            <span>Buscando: <strong>{{ searchTerm }}</strong></span>
            <a href="{% url 'catalog' %}" class="btn btn-sm btn-outline-secondary">Limpiar filtros</a>
        </div>
    {% endif %}

    {% if current_category %}
        <div class="alert alert-info d-flex justify-content-between align-items-center">
            <span>Categoría: <strong>{{ current_category }}</strong></span>
            <a href="{% url 'catalog' %}" class="btn btn-sm btn-outline-secondary">Mostrar todas</a>
        </div>
    {% endif %}

    <!-- Category Quick Filter Tags -->
    <div class="categories">
        <a href="{% url 'catalog' %}" class="category-tag {% if not current_category %}active{% endif %}">Todas</a>
        {% for category in categories %}
            <a href="?category={{ category }}{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}" 
               class="category-tag {% if current_category == category %}active{% endif %}">
                {{ category }}
            </a>
        {% endfor %}
    </div>

    <!-- AI Tools Grid -->
    {% if ai_tools %}
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for ai in ai_tools %}
            <div class="col">
                <a href="{% url 'presentationAI' ai.id %}" class="text-decoration-none text-dark h-100">
                    <div class="card h-100 shadow-sm">
                        <div class="position-relative">
                            {% if ai.image %}
                                <img class="card-img-top" src="{{ ai.image.url }}" alt="{{ ai.name }}">
                            {% else %}
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center">
                                    <span class="text-muted">No image</span>
                                </div>
                            {% endif %}
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge bg-primary">{{ ai.category }}</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{ ai.name }}</h5>
                            <p class="card-text">{{ ai.description|truncatechars:100 }}</p>
                        </div>
                        <div class="card-footer bg-transparent">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted"><strong>Proveedor:</strong> {{ ai.provider }}</small>
                                <div class="popularity-indicator" title="Popularidad: {{ ai.popularity }}%">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= ai.popularity|divisibleby:20 %}
                                            <i class="bi bi-star-fill text-warning"></i>
                                        {% else %}
                                            <i class="bi bi-star text-muted"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if is_paginated %}
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}" aria-label="First">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                {% endif %}
                
                {% for page in page_range %}
                    {% if page == '...' %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% else %}
                        <li class="page-item {% if page == page_obj.number %}active{% endif %}">
                            <a class="page-link" href="?page={{ page }}{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}">{{ page }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ paginator.num_pages }}{% if searchTerm %}&searchAITool={{ searchTerm }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort_by={{ current_sort }}{% endif %}" aria-label="Last">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    {% else %}
        <div class="alert alert-warning text-center mt-5">
            <h4>No se encontraron herramientas IA</h4>
            <p>Intenta con otra búsqueda o filtra por una categoría diferente.</p>
            <a href="{% url 'catalog' %}" class="btn btn-primary mt-2">Ver todas las herramientas</a>
        </div>
    {% endif %}
</div>

<style>
    /* Categories styling */
    .categories {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .category-tag {
        padding: 5px 15px;
        background-color: #f8f9fa;
        border-radius: 50px;
        text-decoration: none;
        color: #495057;
        font-weight: 500;
        border: 1px solid #dee2e6;
        transition: all 0.2s;
    }
    
    .category-tag:hover {
        background-color: #e9ecef;
        color: #212529;
    }
    
    .category-tag.active {
        background-color: #0d6efd;
        color: white;
        border-color: #0d6efd;
    }
    
    /* Card styling */
    .card {
        transition: transform 0.3s, box-shadow 0.3s;
        border: none;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    .card-img-top {
        height: 200px;
        object-fit: cover;
        border-top-left-radius: 0.375rem;
        border-top-right-radius: 0.375rem;
    }
    
    /* Empty image placeholder */
    .card-img-top.bg-light {
        height: 200px;
    }
    
    /* Pagination styling */
    .pagination .page-link {
        color: #0d6efd;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
</style>

<!-- Include Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
{% endblock %}
